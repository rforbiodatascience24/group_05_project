---
title: "Analysis"
author: "Miguel Blanco"
format: html
editor: visual
---

## PCA

### Select numeric columns and normalize

#### Drop NAs (Pass to 02_clean)

```{r}
data_NA_proportion <- NA_prop(data)

columns_todrop <- data_NA_proportion |> 
  filter(na_proportion > 0.1) |> 
  pull(column)

pca_data <- data |> 
  select(-columns_todrop)
```

### Transform columns to numeric

```{r}
pca_data <- pca_data |> 
  select(-Number, -Age_over_65, -Age_range, -ECMO) |> 
  mutate(across(where(is.character), ~ as.numeric(.)))

numeric_scaled_data <- pca_data |> 
  select(where(is.numeric)) |> 
  drop_na() |> 
  scale() |> 
  as.data.frame()
```

```{r}
pca_result <- prcomp(numeric_scaled_data)
```

```{r}
explained_variance <- data.frame(
  PC = paste0("PC", 1:length(pca_result$sdev)),
  Variance = (pca_result$sdev^2) / sum(pca_result$sdev^2)

```

## Find Outcome most Correlated Variable

```{r}
data <- data |> 
  mutate(Death = as.factor(Death))
```

```{r}
data_numeric <- data |> 
  mutate(across(everything(), as.numeric))
```

```{r}
data_pivot <- data |> 
  pivot_longer(
    cols = -Death,
    names_to = "variable",
    values_to = "values"
  )
```

```{r}
NA_prop(data_numeric)
```
